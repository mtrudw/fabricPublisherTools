<html>
  <head>
    <script src="https://cdn.jsdelivr.net/gh/fabricjs/fabric.js@v3.6.3/dist/fabric.min.js"></script>
    <script src=""></script>
  </head>
  <body>

    <h1> Smart Guides </h1>
    Move and scale to align with other objects
    <canvas id="c4" width="800" height="800">
    </canvas>
    <script type="module">
      import {fabricAddSnapper,fabricAddSmartGuides} from 'https://cdn.jsdelivr.net/gh/mtrudw/fabricPublisherTools/dist/fabricPublisherTools.min.js';
      fabricAddSnapper();
      fabricAddSmartGuides();
      var canvas = new fabric.Canvas('c4');
      var rect = new fabric.Rect({left: 100,top:100,width:150,height:100,fill:'blue'});
      var rect2 = new fabric.Rect({left: 500,top:500,width:150,height:100,fill:'green'});
      var rect3 = new fabric.Rect({left: 400,top:200,width:150,height:100,fill:'yellow'});
      canvas._registerSnaps(canvas._getSmartGuides.bind(canvas));
      rect.doesSnap();
      rect2.doesSnap();
      rect3.doesSnap();
      canvas.add(rect,rect2,rect3);
    </script>


    <h1> Snap </h1>
    Snap rectangle to lines
    <canvas id="c3" width="800" height="800">
    </canvas>
    <script type="module">
      import {fabricAddSnapper} from 'https://cdn.jsdelivr.net/gh/mtrudw/fabricPublisherTools/dist/fabricPublisherTools.min.js';
      fabricAddSnapper();
      var canvas = new fabric.Canvas('c3');
       function makeLine(coords) {
	   return new fabric.Line(coords, {
	       fill: 'red',
	       stroke: 'red',
	       strokeWidth: 4,
	       selectable: false,
	       evented: false,
	   });
       }
      var lineHCenter = makeLine([0,398,800,398]),
	  lineVCenter = makeLine([398,0,398,800]),
          lineVLeft = makeLine([98,0,98,800]);

      var rect = new fabric.Rect({left: 100,top:100,width:150,height:100,fill:'blue'});
      canvas._registerSnaps(()=>{return [{ x: 400,
					   validTarget: (obj) => {return true},
					   condition: (obj) => {return true},
					   margin: 8
					 },
					 { x: 100,
					   validTarget: (obj) => {return true},
					   condition: (obj) => {return true},
					   margin: 8
					 },
					]
				}
			   );
      canvas._registerSnaps(()=>{ return [{ y: 400,
					    validTarget: (obj) => {return true},
					    condition: (obj) => {return true},
					    margin: 8
					  }]
				});

      rect.doesSnap();
      canvas.add(lineHCenter,lineVLeft,lineVCenter,rect);
    </script>


    <h1> Image Container </h1>
    Double Click to scale image
    <canvas id="c5" width="800" height="800">
    </canvas>
    <script type="module">
      import {ImageContainer} from 'https://cdn.jsdelivr.net/gh/mtrudw/fabricPublisherTools/dist/fabricPublisherTools.min.js';
      var canvas = new fabric.Canvas('c5');
      var imgContainer = new fabric.ImageContainer({ left: 100,
						     right: 100,
						     width : 400,
						     height: 400,
						     fillcontainer: true,
						   });
      canvas.add(imgContainer);
      imgContainer.loadImage('https://unsplash.com/photos/zPTq--yOK2Y/download?force=true&w=1920');
    </script>

	
    <h1> Undo Redo</h1>
    <canvas id="c1" width="800" height="500">
    </canvas>
    <button id="log">Log Canvas</button>
    <button id="undo">Undo</button>
    <button id="redo">Redo</button>
    <button id="ranCol">Random Color</button>
    <button id="delete">Delete</button>
     <script type="module">

       import {fabricAddObjectIDs, fabricAddUndoRedo} from 'https://cdn.jsdelivr.net/gh/mtrudw/fabricPublisherTools/dist/fabricPublisherTools.min.js';
       fabricAddObjectIDs()
       fabricAddUndoRedo();
       var canvas1 = new fabric.Canvas('c1');
       var rect
       for (var i = 0; i < 10; i++) {
	   rect = new fabric.Rect({
	       width: 10,
	       height: 10,
	       left: i * 15,
	       top: i * 15,
	   });
	   canvas1.add(rect);
       }

      
       function logJSON() {
	   console.log(canvas1.toJSON());
       }
       function getRandomColor() {
	   var letters = '0123456789ABCDEF';
	   var color = '#';
	   for (var i = 0; i < 6; i++) {
	       color += letters[Math.floor(Math.random() * 16)];
	   }
	   return color;
       }
       document.querySelector("#log").addEventListener('click',logJSON);
       document.querySelector("#undo").addEventListener('click',(e)=>{canvas1.undo()});
       document.querySelector("#redo").addEventListener('click',(e)=>{canvas1.redo()});
       document.querySelector("#delete").addEventListener('click',(e)=>{canvas1.getActiveObject() && canvas1.remove(canvas1.getActiveObject())});
       document.querySelector("#ranCol").addEventListener('click',(e)=>{
	   canvas1.getActiveObject() && canvas1.getActiveObject().set('fill',getRandomColor());
	   canvas1.renderAll();});
       
     </script>

    

  </body>
</html>

